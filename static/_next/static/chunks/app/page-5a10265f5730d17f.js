(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2154:function(e,t,n){Promise.resolve().then(n.bind(n,2246))},2246:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Z}});var a=n(9268),l=n(6006),r=n(1649),i=n(4240),s=n(7095),o=n(8235),d=n(2171),c=n(9454),h=n(5857),u=n(5911);let x=e=>{let{handleFileChange:t,handleUpload:n,useOCR:l,setUseOCR:x}=e;return(0,a.jsx)(s.Z,{sx:{maxWidth:600,width:"100%"},children:(0,a.jsx)(o.Z,{children:(0,a.jsxs)("form",{onSubmit:n,children:[(0,a.jsxs)(r.Z,{mb:2,children:[(0,a.jsx)(i.Z,{variant:"body1",children:"Select a PDF file:"}),(0,a.jsx)(d.Z,{type:"file",fullWidth:!0,onChange:t,inputProps:{accept:".pdf"}})]}),(0,a.jsx)(c.Z,{control:(0,a.jsx)(h.Z,{checked:l,onChange:()=>x(!l)}),label:"Run OCR on PDF before extraction"}),(0,a.jsx)(r.Z,{display:"flex",justifyContent:"center",mt:2,children:(0,a.jsx)(u.Z,{variant:"contained",color:"primary",type:"submit",children:"Extract Tables"})})]})})})};var f=n(3334),p=n(536),b=n(9861),m=n(9715);let j=e=>{let{tables:t,currentTableIndex:n,mappings:l,handleMappingChange:d,predefinedOptions:x,handlePrevTable:j,handleNextTable:g,handleDownloadCSV:Z,handleReset:C,setTables:y}=e,v=t[n],S=e=>{let a=[...t];a[n].include=e,y(a)};return(0,a.jsx)(s.Z,{sx:{maxWidth:600,width:"100%",mt:4},children:(0,a.jsxs)(o.Z,{children:[(0,a.jsxs)(i.Z,{variant:"h4",children:["Table ",n+1," of ",t.length]}),v.image&&(0,a.jsx)(r.Z,{display:"flex",justifyContent:"center",my:2,children:(0,a.jsx)("img",{src:"data:image/png;base64,".concat(v.image),alt:"Table ".concat(n+1),style:{maxWidth:"100%",border:"1px solid #ccc",borderRadius:4}})}),(0,a.jsx)(c.Z,{control:(0,a.jsx)(h.Z,{checked:!1!==v.include,onChange:e=>S(e.target.checked)}),label:"Include this table in export"}),v.headers.map(e=>(0,a.jsxs)(f.Z,{fullWidth:!0,sx:{my:2},children:[(0,a.jsx)(p.Z,{children:e}),(0,a.jsxs)(b.Z,{value:l[n][e]||"",onChange:t=>d(e,t.target.value),children:[(0,a.jsx)(m.Z,{value:"",children:"(Keep Original)"}),x.map(e=>(0,a.jsx)(m.Z,{value:e,children:e},e))]})]},e)),(0,a.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",mt:2,children:[(0,a.jsx)(u.Z,{variant:"outlined",onClick:j,disabled:0===n,children:"Previous Table"}),(0,a.jsx)(u.Z,{variant:"contained",onClick:g,disabled:n===t.length-1,children:"Next Table"})]}),n===t.length-1&&(0,a.jsxs)(r.Z,{display:"flex",flexDirection:"column",alignItems:"center",mt:4,children:[(0,a.jsx)(u.Z,{variant:"contained",color:"primary",sx:{mb:2},onClick:Z,children:"Export All Tables as CSV"}),(0,a.jsx)(u.Z,{variant:"outlined",color:"secondary",onClick:C,children:"Submit Another PDF"})]})]})})},g=e=>{let{filePath:t,handleReset:n}=e;return(0,a.jsx)(s.Z,{sx:{maxWidth:600,width:"100%",mt:4},children:(0,a.jsxs)(o.Z,{children:[(0,a.jsx)(i.Z,{variant:"h3",gutterBottom:!0,children:"Download Complete"}),(0,a.jsx)(i.Z,{variant:"h5",children:"Your CSV file has been saved to:"}),(0,a.jsx)(i.Z,{variant:"body1",sx:{mt:2,fontWeight:"bold",wordBreak:"break-all"},children:t}),(0,a.jsx)(u.Z,{variant:"outlined",color:"secondary",onClick:n,children:"Submit Another PDF"})]})})};function Z(){let{isUploaded:e,setIsUploaded:t,tables:n,setTables:s,mappings:o,setMappings:d,currentTableIndex:c,setCurrentTableIndex:h,filePath:u,setFilePath:f,isDownloadComplete:p,setIsDownloadComplete:b,handleUpload:m,handleDownloadCSV:Z}=function(){let[e,t]=(0,l.useState)(!1),[n,a]=(0,l.useState)([]),[r,i]=(0,l.useState)({}),[s,o]=(0,l.useState)(0),[d,c]=(0,l.useState)(null),[h,u]=(0,l.useState)(!1),x=async(e,n)=>{if(!e){alert("Please select a file before uploading.");return}let l=new FormData;l.append("file",e),l.append("useOCR",n.toString());try{let e=await fetch("/api/extract-tables",{method:"POST",body:l}),n=await e.json();if(!n.success){alert("Failed to extract tables.");return}console.log("API Response:",n),a(n.tables),i(n.tables.reduce((e,t,n)=>(e[n]=t.headers.reduce((e,t)=>(e[t]="",e),{}),e),{})),t(!0)}catch(e){console.error("Error extracting tables:",e)}},f=async(e,n)=>{try{let a=e.map((e,t)=>{if(!1===e.include)return null;let a=e.headers,l=e.table_data.map(e=>{let t={};return a.forEach(n=>{t[n]=e[n]}),t});return{headers:a,table_data:l,header_mappings:n[t]}}).filter(Boolean);if(0===a.length){alert("No tables selected for export.");return}let l=await fetch("/api/export-csv",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tables:a})});if(!l.ok)throw Error("Failed to download CSVs");let r=await l.json();t(!1),c(r.file_path),u(!0)}catch(e){console.error("Error exporting CSVs:",e)}};return{isUploaded:e,setIsUploaded:t,tables:n,setTables:a,mappings:r,setMappings:i,currentTableIndex:s,setCurrentTableIndex:o,filePath:d,setFilePath:c,isDownloadComplete:h,setIsDownloadComplete:u,handleUpload:x,handleDownloadCSV:f}}(),{selectedFile:C,useOCR:y,setUseOCR:v,handleFileChange:S,handleMappingChange:k,handleNextTable:w,handlePrevTable:T,handleReset:_}=function(){let[e,t]=(0,l.useState)(null),[n,a]=(0,l.useState)(!1),r=e=>{e.target.files&&e.target.files[0]&&t(e.target.files[0])},i=(e,t,n,a,l)=>{n(t=>({...t,[e]:{...t[e],[a]:l}}))},s=(e,t,n)=>{e<n.length-1&&t(e+1)},o=(e,t)=>{e>0&&t(e-1)},d=(e,n,a,l,r,i,s)=>{t(null),e(!1),n([]),a({}),l(0),r(!1),i(null),s(!1)};return{selectedFile:e,useOCR:n,setUseOCR:a,handleFileChange:r,handleMappingChange:i,handleNextTable:s,handlePrevTable:o,handleReset:d}}();return(0,a.jsxs)(r.Z,{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100vh",bgcolor:"#f5f5f5",children:[(0,a.jsx)(i.Z,{variant:"h3",gutterBottom:!0,children:"COINS PDF EXTRACTOR"}),!e&&!p&&(0,a.jsx)(x,{handleFileChange:S,handleUpload:e=>{e.preventDefault(),m(C,y)},useOCR:y,setUseOCR:v}),e&&n.length>0&&!p&&(0,a.jsx)(j,{tables:n,currentTableIndex:c,mappings:o,handleMappingChange:(e,t)=>k(c,o,d,e,t),predefinedOptions:["ID","Name","Latitude","Longitude","Start_Year","End_Year","Num_Coins_Found","Reference","Comment","External_Link"],handlePrevTable:()=>T(c,h),handleNextTable:()=>w(c,h,n),handleDownloadCSV:()=>Z(n,o),handleReset:()=>_(t,s,d,h,v,f,b),setTables:s}),!e&&p&&u&&(0,a.jsx)(g,{filePath:u,handleReset:()=>_(t,s,d,h,v,f,b)})]})}}},function(e){e.O(0,[863,667,139,744],function(){return e(e.s=2154)}),_N_E=e.O()}]);