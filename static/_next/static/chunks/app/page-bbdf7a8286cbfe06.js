(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2154:function(e,t,n){Promise.resolve().then(n.bind(n,3561))},3561:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var a=n(9268),r=n(6006),l=n(1649),i=n(4240),s=n(7095),o=n(8235),c=n(2171),d=n(9454),h=n(5857),u=n(5911),x=n(3334),f=n(536),p=n(9861),m=n(9715);function j(){let[e,t]=(0,r.useState)(null),[n,j]=(0,r.useState)(!1),[b,Z]=(0,r.useState)([]),[g,v]=(0,r.useState)({}),[C,y]=(0,r.useState)(0),[S,w]=(0,r.useState)(!1),_=["ID","Name","Latitude","Longitude","Start_Year","End_Year","Num_Coins_Found","Reference","Comment","External_Link"],[k,D]=(0,r.useState)(null),[E,P]=(0,r.useState)(!1),O=e=>{e.target.files&&e.target.files[0]&&t(e.target.files[0])},T="http://127.0.0.1:5000",F=async t=>{if(t.preventDefault(),!e){alert("Please select a file before uploading.");return}let n=new FormData;n.append("file",e),n.append("useOCR",S.toString());try{let e=await fetch("".concat(T,"/api/extract-tables"),{method:"POST",body:n}),t=await e.json();if(!t.success){alert("Failed to extract tables.");return}Z(t.tables),v(t.tables.reduce((e,t,n)=>(e[n]=t.headers.reduce((e,t)=>(e[t]="",e),{}),e),{})),j(!0)}catch(e){console.error("Error extracting tables:",e)}},N=(e,t)=>{v(n=>({...n,[C]:{...n[C],[e]:t}}))},R=()=>{C<b.length-1&&y(C+1)},W=()=>{C>0&&y(C-1)},A=async e=>{e.preventDefault();try{let e=b.map((e,t)=>{let n=e.headers,a=e.table_data.map(e=>{let t={};return n.forEach(n=>{t[n]=e[n]}),t});return{headers:n,table_data:a,header_mappings:g[t]}}),t=await fetch("".concat(T,"/api/export-csv"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tables:e})});if(!t.ok)throw Error("Failed to download CSVs");let n=await t.json();j(!1),D(n.file_path),P(!0)}catch(e){console.error("Error exporting CSVs:",e)}},I=()=>{t(null),j(!1),Z([]),v({}),y(0),w(!1),D(null),P(!1)};return(0,a.jsxs)(l.Z,{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100vh",bgcolor:"#f5f5f5",children:[(0,a.jsx)(i.Z,{variant:"h3",gutterBottom:!0,children:"COINS PDF EXTRACTOR"}),!n&&!E&&(0,a.jsx)(s.Z,{sx:{maxWidth:600,width:"100%"},children:(0,a.jsx)(o.Z,{children:(0,a.jsxs)("form",{onSubmit:F,children:[(0,a.jsxs)(l.Z,{mb:2,children:[(0,a.jsx)(i.Z,{variant:"body1",children:"Select a PDF file:"}),(0,a.jsx)(c.Z,{type:"file",fullWidth:!0,onChange:O,inputProps:{accept:".pdf"}})]}),(0,a.jsx)(d.Z,{control:(0,a.jsx)(h.Z,{checked:S,onChange:()=>w(!S)}),label:"Run OCR on PDF before extraction"}),(0,a.jsx)(l.Z,{display:"flex",justifyContent:"center",mt:2,children:(0,a.jsx)(u.Z,{variant:"contained",color:"primary",type:"submit",children:"Extract Tables"})})]})})}),n&&b.length>0&&!E&&(0,a.jsx)(s.Z,{sx:{maxWidth:600,width:"100%",mt:4},children:(0,a.jsxs)(o.Z,{children:[(0,a.jsxs)(i.Z,{variant:"h4",children:["Table ",C+1," of ",b.length]}),b[C].headers.map(e=>(0,a.jsxs)(x.Z,{fullWidth:!0,sx:{my:2},children:[(0,a.jsx)(f.Z,{children:e}),(0,a.jsxs)(p.Z,{value:g[C][e]||"",onChange:t=>N(e,t.target.value),children:[(0,a.jsx)(m.Z,{value:"",children:"(Keep Original)"}),_.map(e=>(0,a.jsx)(m.Z,{value:e,children:e},e))]})]},e)),(0,a.jsxs)(l.Z,{display:"flex",justifyContent:"space-between",mt:2,children:[(0,a.jsx)(u.Z,{variant:"outlined",onClick:W,disabled:0===C,children:"Previous Table"}),(0,a.jsx)(u.Z,{variant:"contained",onClick:R,disabled:C===b.length-1,children:"Next Table"})]}),C===b.length-1&&(0,a.jsxs)(l.Z,{display:"flex",flexDirection:"column",alignItems:"center",mt:4,children:[(0,a.jsx)(u.Z,{variant:"contained",color:"primary",sx:{mb:2},onClick:e=>A(e),children:"Export All Tables as CSV"}),(0,a.jsx)(u.Z,{variant:"outlined",color:"secondary",onClick:I,children:"Submit Another PDF"})]})]})}),!n&&E&&k&&(0,a.jsx)(s.Z,{sx:{maxWidth:600,width:"100%",mt:4},children:(0,a.jsxs)(o.Z,{children:[(0,a.jsx)(i.Z,{variant:"h3",gutterBottom:!0,children:"Download Complete"}),(0,a.jsx)(i.Z,{variant:"h5",children:"Your CSV file has been saved to:"}),(0,a.jsx)(i.Z,{variant:"body1",sx:{mt:2,fontWeight:"bold",wordBreak:"break-all"},children:k}),(0,a.jsx)(u.Z,{variant:"outlined",color:"secondary",onClick:I,children:"Submit Another PDF"})]})})]})}}},function(e){e.O(0,[863,667,139,744],function(){return e(e.s=2154)}),_N_E=e.O()}]);